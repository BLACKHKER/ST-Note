## C++ Based

#### 函数声明

一个函数引用外部函数时，需要进行一个预声明，来表示这个函数是由外部引用的，不在本文件中

Main.cpp

```c++
#include <iostream>

/* 预声明Log是一个函数，定义在其他文件中 */
void Log(const char*);
/* 形参可以省略，但建议加上，便于提高维护性 */
void Log(const char* message);

int main()
{
    /* 日志打印 */
    Log("Hello World!");
    std::cin.get();
}
```

Log.cpp

```c++
#include <iostream>

void Log(const char* message)
{
    std::cout << message << std::endl;
}
```

##### 总结

函数声明会告诉编译器，哪些东西虽然没有在当前文件定义，但是是在其他文件中定义的；

编译器其实并不确定在其他文件中是否真的定义了，但声明了编译器便不再报错。

那么编译器是如何运行到正确的代码的？解决这个问题的，就是链接(Linking)



---



### 编译与链接

#### 编译(Compile)

> 参考编译原理(书) TODO
>
> 编译是针对一个源文件(.cpp)的，有多少个源文件就需要编译多少次，生成对应个数的目标文件**(.obj)**

##### 为什么会有编译

以下是二进制表示输出到控制台"VIP会员"的命令

```v
指令(输出)    V        I        P            会                员
10110000 10101011 00110001 00011100 00110011 00111110 01010011 11110000
```

二进制效率过于低下，所以有了编程语言来简化这个步骤，不需要编写二进制指令了；

但是CPU只执行二进制指令，那么就有了一个工具，**编译器(Compiler)**，由编译器将代码转换成二进制的格式。

编译器能够识别代码中的关键字和特定的语法，按照代码的思路转换成二进制代码，这个过程就是**编译(Compile)**

C语言的编译器由很多种，取决于平台：

| 平台      | 编译器     | 编译生成格式 |
| --------- | ---------- | ------------ |
| Windows   | Visual C++ | .obj         |
| Linux     | GCC        | .o           |
| Unix(Mac) | LLVM/Clang |              |

C++编译后生成一个**目标文件(.obj)**文件，这个文件是二进制格式，跟可执行文件.exe是一样的；



##### 为什么编译不直接生成可执行文件

1. 模块化编译：将程序分为多个编译单元（源文件）可以提高代码的可维护性和编译的效率。每个编译单元可以独立地进行编译，生成对应的目标文件。这种模块化的编译方式使得只有在需要时才需要重新编译修改的部分，而不必重新编译整个程序。这对于大型项目来说特别重要。
2. 链接过程：生成目标文件是为了后续的链接过程。链接器将多个目标文件（以及必要的库文件）合并在一起，解决符号引用、进行地址重定位等操作，生成最终的可执行文件。链接过程需要将目标文件与系统组件（如标准库和动态链接库）结合起来，以创建一个完整的可执行文件。
3. 可移植性：生成目标文件可以使得代码在不同的平台上进行链接和执行。目标文件是与特定平台无关的中间格式，可以在不同的操作系统和硬件上进行链接，以生成适用于该平台的可执行文件。

编译只是将代码变成CPU可直接执行的二进制形式，它还需要和系统组件(标准库、动态链接库)结合起来，这些组件是必须的。组件可以理解为系统API或自己写的函数，函数在不同的.cpp文件中相互引用，就需要**链接(Link)**



##### 运行原理

编译器执行时，首先会对代码进行预处理，也就是说所有的预处理语句优先执行。

预处理之后剩余的代码会进行记号化和解析，把代码整理成编译器能够理解和推理的格式；或者说将代码转换成常量数据和各种指令。最后变成一个**抽象语法树**，它是代码整个执行流程的一种表示。最后根据这个抽象语法树生成二进制代码，机器码。

.cpp文件我们成为**翻译单元**，翻译单元





##### 



#### 链接(Link)

链接其实是一个"打包"的过程，将所有目标文件整个成一个可执行文件，这个工作交给**链接器(Linker)**

链接器的工作是连接函数，将多个源文件中的函数调用整合起来。

在build整个项目时，所有文件都会被编译。链接器会找到正确的函数的定义位置，并将函数定义(函数体)导入到声明该函数的文件中，供其他文件使用。如果找不到函数定义，就报链接错误，“无法解析的外部符号”





































